<?xml version="1.0" encoding="UTF-8" ?>
<etl-config id="eod-history-mongo">

    <archives>
        <Archive id="DataStore" base="/Users/ldaniels/broadway/archive" compression="gzip" />
    </archives>

    <triggers>
        <FileTrigger id="TradingHistory" path="/Users/ldaniels/broadway/incoming/tradingHistory" archive="DataStore">
            <feed name="AMEX_(.*)[.]txt" match="regex">
                <flows>
                    <BasicFlow id="EOD_to_Mongo" input="input_file" input-layout="input_layout" output="mongodb" output-layout="mongo_output"/>
                </flows>
            </feed>
            <feed name="NASDAQ_(.*)[.]txt" match="regex">
                <flows>
                    <BasicFlow id="EOD_to_Mongo" input="input_file" input-layout="input_layout" output="mongodb" output-layout="mongo_output"/>
                </flows>
            </feed>
            <feed name="NYSE_(.*)[.]txt" match="regex">
                <flows>
                    <BasicFlow id="EOD_to_Mongo" input="input_file" input-layout="input_layout" output="mongodb" output-layout="mongo_output"/>
                </flows>
            </feed>
            <feed name="OTCBB_(.*)[.]txt" match="regex">
                <flows>
                    <BasicFlow id="EOD_to_Mongo" input="input_file" input-layout="input_layout" output="mongodb" output-layout="mongo_output"/>
                </flows>
            </feed>
        </FileTrigger>
    </triggers>

    <devices>
        <TextFileInputSource id="input_file" path="{{ flow.input.path }}" />
        <MongoOutputSource id="mongodb" servers="localhost" database="shocktrade" collection="test_history" layout="mongo_output"/>
    </devices>

    <layouts>
        <TextLayout id="input_layout">
            <header>
                <fields type="csv">
                    <field auto-trim="yes">&lt;ticker&gt;</field>
                    <field auto-trim="yes">&lt;date&gt;</field>
                    <field auto-trim="yes">&lt;open&gt;</field>
                    <field auto-trim="yes">&lt;high&gt;</field>
                    <field auto-trim="yes">&lt;low&gt;</field>
                    <field auto-trim="yes">&lt;close&gt;</field>
                    <field auto-trim="yes">&lt;vol&gt;</field>
                </fields>
            </header>
            <body>
                <fields type="csv">
                    <field auto-trim="yes">ticker</field>
                    <field auto-trim="yes">date</field>
                    <field auto-trim="yes">open</field>
                    <field auto-trim="yes">high</field>
                    <field auto-trim="yes">low</field>
                    <field auto-trim="yes">close</field>
                    <field auto-trim="yes">vol</field>
                </fields>
            </body>
        </TextLayout>

        <MongoLayout id="mongo_output">
            <fields type="json">
                <field auto-trim="yes">ticker</field>
                <field auto-trim="yes">date</field>
                <field auto-trim="yes">open</field>
                <field auto-trim="yes">high</field>
                <field auto-trim="yes">low</field>
                <field auto-trim="yes">close</field>
                <field auto-trim="yes">vol</field>
            </fields>
        </MongoLayout>
    </layouts>
</etl-config>