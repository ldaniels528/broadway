<?xml version="1.0" encoding="UTF-8" ?>
<story id="eod-companies">

    <import path="./app-cli/src/test/resources/global_settings.xml" />

    <triggers>
        <StartUpTrigger id="Files_Combiner">
            <CompositionFlow id="combiner" output-source="mongodb">
                <include input-source="AMEX.txt" />
                <include input-source="NASDAQ.txt" />
                <include input-source="NYSE.txt" />
                <include input-source="OTCBB.txt" />
            </CompositionFlow>
        </StartUpTrigger>
    </triggers>

    <data-sources>
        <TextFileInputSource id="AMEX.txt" path="./app-cli/src/test/resources/files/AMEX.txt" layout="eod_company_input_layout" />
        <TextFileInputSource id="NASDAQ.txt" path="./app-cli/src/test/resources/files/NASDAQ.txt" layout="eod_company_input_layout" />
        <TextFileInputSource id="NYSE.txt" path="./app-cli/src/test/resources/files/NYSE.txt" layout="eod_company_input_layout" />
        <TextFileInputSource id="OTCBB.txt" path="./app-cli/src/test/resources/files/OTCBB.txt" layout="eod_company_input_layout" />

        <ConcurrentOutputSource id="mongodb" concurrency="10">
            <data-sources>
                <MongoOutputSource id="mongo1" servers="localhost" database="shocktrade" collection="test_companies" layout="mongo-output"/>
            </data-sources>
        </ConcurrentOutputSource>
    </data-sources>

    <layouts>
        <TextLayout id="eod_company_input_layout">
            <header>
                <record type="delimited" delimiter="\t">
                    <field name="symbol" value="Symbol" type="string"/>
                    <field name="description" value="Description" type="string"/>
                </record>
            </header>
            <body>
                <record type="delimited" delimiter="\t">
                    <field name="symbol" type="string"/>
                    <field name="description" type="string"/>
                </record>
            </body>
        </TextLayout>

        <MongoLayout id="mongo-output">
            <record type="json">
                <field name="symbol" type="string"/>
                <field name="description" type="string"/>
            </record>
        </MongoLayout>
    </layouts>
</story>