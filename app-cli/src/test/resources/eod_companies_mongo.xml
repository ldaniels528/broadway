<?xml version="1.0" encoding="UTF-8" ?>
<etl-config id="eod-companies">

    <triggers>
        <StartUpTrigger flow-ref="AMEX" />
        <StartUpTrigger flow-ref="NASDAQ" />
        <StartUpTrigger flow-ref="NYSE" />
        <StartUpTrigger flow-ref="OTCBB" />
    </triggers>

    <flows>
        <BasicFlow id="AMEX" input="AMEX.txt" output="mongodb" input-layout="tabbed-delimited" output-layout="mongo-output"/>
        <BasicFlow id="NASDAQ" input="NASDAQ.txt" output="mongodb" input-layout="tabbed-delimited" output-layout="mongo-output"/>
        <BasicFlow id="NYSE" input="NYSE.txt" output="mongodb" input-layout="tabbed-delimited" output-layout="mongo-output"/>
        <BasicFlow id="OTCBB" input="OTCBB.txt" output="mongodb" input-layout="tabbed-delimited" output-layout="mongo-output"/>
    </flows>

    <devices>
        <TextFileInputDevice id="AMEX.txt" path="./app-cli/src/test/resources/files/AMEX.txt"/>
        <TextFileInputDevice id="NASDAQ.txt" path="./app-cli/src/test/resources/files/NASDAQ.txt"/>
        <TextFileInputDevice id="NYSE.txt" path="./app-cli/src/test/resources/files/NYSE.txt"/>
        <TextFileInputDevice id="OTCBB.txt" path="./app-cli/src/test/resources/files/OTCBB.txt"/>

        <RoundRobinOutputDevice id="mongodb" concurrency="10">
            <devices>
                <MongoOutputDevice id="mongo1" servers="localhost" database="shocktrade" collection="test_companies" layout="mongo-output"/>
            </devices>
        </RoundRobinOutputDevice>
    </devices>

    <layouts>
        <TextLayout id="tabbed-delimited">
            <header>
                <fields type="delimited" delimiter="\t">
                    <field auto-trim="yes">Symbol</field>
                    <field auto-trim="yes">Description</field>
                </fields>
            </header>
            <body>
                <fields type="delimited" delimiter="\t">
                    <field auto-trim="yes">symbol</field>
                    <field auto-trim="yes">description</field>
                </fields>
            </body>
        </TextLayout>

        <MongoLayout id="mongo-output">
            <fields type="json">
                <field>symbol</field>
                <field>description</field>
            </fields>
        </MongoLayout>
    </layouts>
</etl-config>