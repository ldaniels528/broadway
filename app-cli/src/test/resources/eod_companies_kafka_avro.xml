<?xml version="1.0" encoding="UTF-8" ?>
<story id="eod-companies">

    <triggers>
        <StartUpTrigger id="Files_Combiner">
            <flows>
                <BasicFlow id="AMEX" input="AMEX.txt" output="kafka-topic" input-layout="tabbed-delimited" output-layout="avro-schema"/>
                <BasicFlow id="NASDAQ" input="NASDAQ.txt" output="kafka-topic" input-layout="tabbed-delimited" output-layout="avro-schema"/>
                <BasicFlow id="NYSE" input="NYSE.txt" output="kafka-topic" input-layout="tabbed-delimited" output-layout="avro-schema"/>
                <BasicFlow id="OTCBB" input="OTCBB.txt" output="kafka-topic" input-layout="tabbed-delimited" output-layout="avro-schema"/>
            </flows>
        </StartUpTrigger>
    </triggers>

    <data-sources>
        <TextFileInputSource id="AMEX.txt" path="./app-cli/src/test/resources/files/AMEX.txt" />
        <TextFileInputSource id="NASDAQ.txt" path="./app-cli/src/test/resources/files/NASDAQ.txt" />
        <TextFileInputSource id="NYSE.txt" path="./app-cli/src/test/resources/files/NYSE.txt" />
        <TextFileInputSource id="OTCBB.txt" path="./app-cli/src/test/resources/files/OTCBB.txt" />
        <KafkaOutputSource id="kafka-topic" topic="shocktrade.companies.avro" connectionString="vault114:2181" />
    </data-sources>

    <layouts>
        <TextLayout id="tabbed-delimited">
            <header>
                <record type="delimited" delimiter="\t">
                    <field auto-trim="yes">label1</field>
                    <field auto-trim="yes">label2</field>
                </record>
            </header>
            <body>
                <record type="delimited" delimiter="\t">
                    <field auto-trim="yes">symbol</field>
                    <field auto-trim="yes">description</field>
                </record>
            </body>
        </TextLayout>

        <AvroLayout id="avro-schema">
            <record type="json">
                <field auto-trim="yes">symbol</field>
                <field auto-trim="yes">description</field>
            </record>
            <schema>
            {
                "type": "record",
                "name": "EodCompanyInfo",
                "namespace": "com.shocktrade.avro",
                "record":[
                    { "name": "symbol", "type":"string", "doc":"stock symbol" },
                    { "name": "description", "type":"string", "doc":"company description" }
                ],
                "doc": "A schema for EodData quotes"
            }
            </schema>
        </AvroLayout>
    </layouts>
</story>