<?xml version="1.0" encoding="UTF-8" ?>
<etl-config id="eod-history">
    <flows>
        <BasicFlow id="EOD->CSV" input="input_file" output="output_file"/>
    </flows>

    <devices>
        <TextInputDevice id="input_file" path="./app-cli/src/test/resources/files/OTCBB_20121217.txt" layout="input_layout"/>
        <TextOutputDevice id="output_file" path="/tmp/otcbb_output.txt" layout="output_layout"/>
    </devices>

    <functions>
        <function id="dateReformat">
            def execute(layout: input_layout) = {

            }
        </function>
    </functions>

    <layouts>
        <TextLayout id="input_layout">
            <header>
                <fields type="csv">
                    <field auto-trim="yes">&lt;ticker&gt;</field>
                    <field auto-trim="yes">&lt;date&gt;</field>
                    <field auto-trim="yes">&lt;open&gt;</field>
                    <field auto-trim="yes">&gt;high&gt;</field>
                    <field auto-trim="yes">&gt;low&gt;</field>
                    <field auto-trim="yes">&gt;close&gt;</field>
                    <field auto-trim="yes">&gt;vol&gt;</field>
                </fields>
            </header>
            <body>
                <fields type="csv">
                    <field auto-trim="yes">ticker</field>
                    <field auto-trim="yes">date</field>
                    <field auto-trim="yes">open</field>
                    <field auto-trim="yes">high</field>
                    <field auto-trim="yes">low</field>
                    <field auto-trim="yes">close</field>
                    <field auto-trim="yes">vol</field>
                </fields>
            </body>
        </TextLayout>

        <TextLayout id="output_layout">
            <header>
                <fields type="fixed-length">
                    <field length="10">ticker</field>
                    <field length="9">date</field>
                    <field length="12">open</field>
                    <field length="12">high</field>
                    <field length="12">low</field>
                    <field length="12">close</field>
                    <field length="12">vol</field>
                </fields>
            </header>
            <body>
                <fields type="fixed-length">
                    <field length="10">ticker</field>
                    <field length="9">date</field>
                    <field length="12">open</field>
                    <field length="12">high</field>
                    <field length="12">low</field>
                    <field length="12">close</field>
                    <field length="12">vol</field>
                </fields>
            </body>
            <footer>
                <fields type="fixed-length">
                    <field length="15">input</field>
                    <field length="10">{{ input_file.__OFFSET }}</field>
                    <field length="15">output</field>
                    <field length="10">{{ output_file.__OFFSET }}</field>
                </fields>
            </footer>
        </TextLayout>
    </layouts>
</etl-config>